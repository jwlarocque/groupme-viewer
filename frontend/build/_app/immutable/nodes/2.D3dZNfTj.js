import{b as E,t as b,c as B}from"../chunks/disclose-version.LPu2b5Xb.js";import{ai as De,l as be,j as R,k as ke,aj as Ne,c as z,q as j,x as Me,_ as Oe,u as G,b as K,$ as de,ak as me,al as he,am as xe,p as W,t as ae,ag as Re,O as He,m as ie,A as Pe,y as Ve,i as ze,K as Se,H as qe,r as ye,n as ve,F as Ye,an as Fe,e as pe,ao as fe,ap as ce,aq as Ge,ar as Be,J as je,as as Je,at as Ke,au as Te,av as Xe,C as Qe,aw as _e,a4 as Le,P as H,a3 as L,a1 as I,a2 as A,a0 as M,d as o,ax as We,M as te,N as se,ad as Y}from"../chunks/runtime.BM5HW0gb.js";import{d as Ze,e as $e,s as C}from"../chunks/render.CPp_cGt3.js";import{a as ea,i as O}from"../chunks/if.wMJl1eQN.js";const le=0,ee=1,oe=2;function we(a,e,r,i,t){R&&ke();var u=a,d=De(),x=He,y,_,v,n,s=d?K(void 0):de(void 0),l=d?K(void 0):de(void 0),f=!1;function h(m,c){f=!0,c&&(me(w),he(w),xe(x)),m===le&&r&&(_?W(_):_=j(()=>r(u))),m===ee&&i&&(v?W(v):v=j(()=>i(u,s))),m===oe&&t&&(n?W(n):n=j(()=>t(u,l))),m!==le&&_&&ae(_,()=>_=null),m!==ee&&v&&ae(v,()=>v=null),m!==oe&&n&&ae(n,()=>n=null),c&&(xe(null),he(null),me(null),Re())}var w=be(()=>{if(y!==(y=e())){if(Ne(y)){var m=y;f=!1,m.then(c=>{m===y&&(z(s,c),h(ee,!0))},c=>{m===y&&(z(l,c),h(oe,!0))}),R?r&&(_=j(()=>r(u))):Me(()=>{f||h(le,!0)})}else z(s,y),h(ee,!1);return Oe}});R&&(u=G)}let ue=null;function re(a,e){return e}function aa(a,e,r,i){for(var t=[],u=e.length,d=0;d<u;d++)Be(e[d].e,t,!0);var x=u>0&&t.length===0&&r!==null;if(x){var y=r.parentNode;je(y),y.append(r),i.clear(),q(a,e[0].prev,e[u-1].next)}Je(t,()=>{for(var _=0;_<u;_++){var v=e[_];x||(i.delete(v.k),q(a,v.prev,v.next)),Ke(v.e,!x)}})}function ne(a,e,r,i,t,u=null){var d=a,x={flags:e,items:new Map,first:null},y=(e&Te)!==0;if(y){var _=a;d=R?ie(Pe(_)):_.appendChild(Ve())}R&&ke();var v=null;be(()=>{var n=r(),s=ze(n)?n:n==null?[]:Se(n),l=s.length;let f=!1;if(R){var h=d.data===qe;h!==(l===0)&&(d=ye(),ie(d),ve(!1),f=!0)}if(R){for(var w=null,m,c=0;c<l;c++){if(G.nodeType===8&&G.data===Ye){d=G,f=!0,ve(!1);break}var g=s[c],p=i(g,c);m=Ce(G,x,w,null,g,p,c,t,e),x.items.set(p,m),w=m}l>0&&ie(ye())}R||ra(s,x,d,t,e,i),u!==null&&(l===0?v?W(v):v=j(()=>u(d)):v!==null&&ae(v,()=>{v=null})),f&&ve(!0)}),R&&(d=G)}function ra(a,e,r,i,t,u){var F,$,X,Q;var d=(t&Xe)!==0,x=(t&(fe|ce))!==0,y=a.length,_=e.items,v=e.first,n=v,s,l=null,f,h=[],w=[],m,c,g,p;if(d)for(p=0;p<y;p+=1)m=a[p],c=u(m,p),g=_.get(c),g!==void 0&&((F=g.a)==null||F.measure(),(f??(f=new Set)).add(g));for(p=0;p<y;p+=1){if(m=a[p],c=u(m,p),g=_.get(c),g===void 0){var D=n?n.e.nodes_start:r;l=Ce(D,e,l,l===null?e.first:l.next,m,c,p,i,t),_.set(c,l),h=[],w=[],n=l.next;continue}if(x&&na(g,m,p,t),g.e.f&Fe&&(W(g.e),d&&(($=g.a)==null||$.unfix(),(f??(f=new Set)).delete(g))),g!==n){if(s!==void 0&&s.has(g)){if(h.length<w.length){var k=w[0],S;l=k.prev;var U=h[0],N=h[h.length-1];for(S=0;S<h.length;S+=1)Ae(h[S],k,r);for(S=0;S<w.length;S+=1)s.delete(w[S]);q(e,U.prev,N.next),q(e,l,U),q(e,N,k),n=k,l=N,p-=1,h=[],w=[]}else s.delete(g),Ae(g,n,r),q(e,g.prev,g.next),q(e,g,l===null?e.first:l.next),q(e,l,g),l=g;continue}for(h=[],w=[];n!==null&&n.k!==c;)(s??(s=new Set)).add(n),w.push(n),n=n.next;if(n===null)continue;g=n}h.push(g),l=g,n=g.next}if(n!==null||s!==void 0){for(var T=s===void 0?[]:Se(s);n!==null;)T.push(n),n=n.next;var P=T.length;if(P>0){var V=t&Te&&y===0?r:null;if(d){for(p=0;p<P;p+=1)(X=T[p].a)==null||X.measure();for(p=0;p<P;p+=1)(Q=T[p].a)==null||Q.fix()}aa(e,T,V,_)}}d&&Me(()=>{var ge;if(f!==void 0)for(g of f)(ge=g.a)==null||ge.apply()}),pe.first=e.first&&e.first.e,pe.last=l&&l.e}function na(a,e,r,i){i&fe&&z(a.v,e),i&ce?z(a.i,r):a.i=r}function Ce(a,e,r,i,t,u,d,x,y){var _=ue;try{var v=(y&fe)!==0,n=(y&Ge)===0,s=v?n?de(t):K(t):t,l=y&ce?K(d):d,f={i:l,v:s,k:u,a:null,e:null,prev:r,next:i};return ue=f,f.e=j(()=>x(a,s,l),R),f.e.prev=r&&r.e,f.e.next=i&&i.e,r===null?e.first=f:(r.next=f,r.e.next=f.e),i!==null&&(i.prev=f,i.e.prev=f.e),f}finally{ue=_}}function Ae(a,e,r){for(var i=a.next?a.next.e.nodes_start:r,t=e?e.e.nodes_start:r,u=a.e.nodes_start;u!==i;){var d=Qe(u);t.before(u),u=d}}function q(a,e,r){e===null?a.first=r:(e.next=r,e.e.next=r&&r.e),r!==null&&(r.prev=e,r.e.prev=e&&e.e)}let Ee=!1;function ta(){Ee||(Ee=!0,document.addEventListener("reset",a=>{Promise.resolve().then(()=>{var e;if(!a.defaultPrevented)for(const r of a.target.elements)(e=r.__on_r)==null||e.call(r)})},{capture:!0}))}function J(a,e,r,i){r=r==null?null:r+"";var t=a.__attributes??(a.__attributes={});R&&(t[e]=a.getAttribute(e),e==="src"||e==="href"||e==="srcset")||t[e]!==(t[e]=r)&&(e==="loading"&&(a[_e]=r),r===null?a.removeAttribute(e):a.setAttribute(e,r))}function Ie(a){if(!R&&a.loading==="lazy"){var e=a.src;a[_e]=null,a.loading="eager",a.removeAttribute("src"),requestAnimationFrame(()=>{a[_e]!=="eager"&&(a.loading="lazy"),a.src=e})}}function sa(a,e,r,i=r){a.addEventListener(e,r);const t=a.__on_r;t?a.__on_r=()=>{t(),i()}:a.__on_r=i,ta()}function Ue(a,e,r){if(a.multiple)return la(a,e);for(var i of a.options){var t=Z(i);if(ea(t,e)){i.selected=!0;return}}(!r||e!==void 0)&&(a.selectedIndex=-1)}function ia(a,e){Le(()=>{var r=new MutationObserver(()=>{var i=a.__value;Ue(a,i)});return r.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{r.disconnect()}})}function va(a,e,r){var i=!0;sa(a,"change",()=>{var t;if(a.multiple)t=[].map.call(a.querySelectorAll(":checked"),Z);else{var u=a.querySelector(":checked");t=u&&Z(u)}r(t)}),Le(()=>{var t=e();if(Ue(a,t,i),i&&t===void 0){var u=a.querySelector(":checked");u!==null&&(t=Z(u),r(t))}a.__value=t,i=!1}),ia(a)}function la(a,e){for(var r of a.options)r.selected=~e.indexOf(Z(r))}function Z(a){return"__value"in a?a.__value:a.value}var oa=(a,e)=>z(e,!o(e)),ua=(a,e)=>z(e,!o(e)),da=a=>a.stopPropagation(),_a=b('<div class="overlay svelte-6ahm6s"><img loading="lazy" class="svelte-6ahm6s"></div>'),fa=b('<img loading="lazy" class="svelte-6ahm6s"> <!>',1);function ca(a,e){let r=K(!1);var i=fa();$e("keydown",We,d=>{o(r)&&d.key==="Escape"&&z(r,!1)});var t=H(i);t.__click=[oa,r];var u=L(t,2);O(u,()=>o(r),d=>{var x=_a();x.__click=[ua,r];var y=I(x);y.__click=[da],A(x),M(()=>J(y,"src",e.url)),Ie(y),E(d,x)}),M(()=>J(t,"src",e.url)),Ie(t),E(a,i)}Ze(["click"]);var ga=b('<video controls preload="none" class="svelte-18z06ww"></video>');function ma(a,e){var r=ga();M(()=>J(r,"src",e.url)),E(a,r)}var ha=b('<div class="message-header svelte-13v7xlb"><div class="message-sender"><span> </span></div> <div class="timestamp svelte-13v7xlb"> </div></div>'),xa=b("<p>Reply to: <a> </a></p>"),ya=b("<p> </p> <p> </p>",1),pa=b('<div class="attachments svelte-13v7xlb"></div>'),wa=b('<p class="svelte-13v7xlb"> </p>'),Aa=b('<div class="reaction svelte-13v7xlb"> <span class="reactors svelte-13v7xlb"> </span></div>'),Ea=b('<div class="reactions"></div>'),Ia=b('<div class="message"><!> <div class="message-content svelte-13v7xlb"><!> <!> <!></div></div>');function ba(a,e){te(e,!0);const r=5*60;var i=Ia(),t=I(i);O(t,()=>!e.lastMessage||e.message.created_at-e.lastMessage.created_at>r||e.message.sender_id!==e.lastMessage.sender_id,_=>{var v=ha(),n=I(v),s=I(n),l=I(s);A(s),A(n);var f=L(n,2),h=I(f);M(()=>C(h,new Date(e.message.created_at*1e3).toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!1}))),A(f),A(v),M(()=>{var w,m;return C(l,`${e.message.name??""}${(((w=e.users[e.message.sender_id])==null?void 0:w.name)!=e.message.name?` (${((m=e.users[e.message.sender_id])==null?void 0:m.name)||"inactive"})`:"")??""}`)}),E(_,v)});var u=L(t,2),d=I(u);O(d,()=>{var _,v;return((v=(_=e.message)==null?void 0:_.attachments)==null?void 0:v.filter(n=>n.type!=="mentions").length)>0},_=>{var v=pa();ne(v,21,()=>e.message.attachments,re,(n,s)=>{var l=B(),f=H(l);O(f,()=>o(s).type==="image",h=>{var w=Y(()=>e.convertImageUrl(e.message.id,o(s).url));ca(h,{get url(){return o(w)}})},h=>{var w=B(),m=H(w);O(m,()=>o(s).type==="mentions",c=>{},c=>{var g=B(),p=H(g);O(p,()=>o(s).type==="video",D=>{var k=Y(()=>e.convertVideoUrl(e.message.id,o(s).url));ma(D,{get url(){return o(k)}})},D=>{var k=B(),S=H(k);O(S,()=>o(s).type==="reply",U=>{var N=xa(),T=L(I(N)),P=I(T);M(()=>{var V;return C(P,`${((V=e.users[o(s).user_id.toString()])==null?void 0:V.name)??""} - ${o(s).reply_id??""}`)}),A(T),A(N),M(()=>J(T,"href",`#${o(s).reply_id??""}`)),E(U,N)},U=>{var N=ya(),T=H(N),P=I(T);A(T);var V=L(T,2),F=I(V);A(V),M(()=>{C(P,o(s).type),C(F,o(s).url)}),E(U,N)},!0),E(D,k)},!0),E(c,g)},!0),E(h,w)}),E(n,l)}),A(v),E(_,v)});var x=L(d,2);O(x,()=>e.message.text,_=>{var v=wa(),n=I(v);A(v),M(()=>C(n,e.message.text)),E(_,v)});var y=L(x,2);O(y,()=>{var _,v;return((v=(_=e.message)==null?void 0:_.reactions)==null?void 0:v.length)>0},_=>{var v=Ea();ne(v,21,()=>e.message.reactions,re,(n,s)=>{var l=Aa();M(()=>J(l,"title",o(s).user_ids.map(m=>{var c;return(c=e.users[m])==null?void 0:c.name}).join(", ")));var f=I(l),h=L(f),w=I(h);M(()=>C(w,`- ${o(s).user_ids.map(m=>{var c;return(c=e.users[m])==null?void 0:c.name}).join(", ")??""}`)),A(h),A(l),M(()=>{var m;return C(f,`${(((m=o(s))==null?void 0:m.code)||"❤️")??""} ${o(s).user_ids.length??""} `)}),E(n,l)}),A(v),E(_,v)}),A(u),A(i),M(()=>J(i,"id",e.message.id)),E(a,i),se()}var ka=b('<div class="message-header svelte-1mmvllb"><div class="message-sender"><span> </span></div> <div> </div> <div class="timestamp"> </div></div>');function Ma(a,e){te(e,!0);var r=ka(),i=I(r),t=I(i),u=I(t);A(t),A(i);var d=L(i,2),x=I(d);A(d);var y=L(d,2),_=I(y);M(()=>C(_,new Date(e.message.created_at*1e3).toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!1}))),A(y),A(r),M(()=>{C(u,e.message.name),C(x,e.message.text)}),E(a,r),se()}var Sa=b('<div class="timestamp timestamp-standalone svelte-1l60u2z"> </div>'),Ta=b("<!> <!>",1),La=b('<main class="svelte-1l60u2z"></main>');function Ca(a,e){te(e,!0);const r=60*60;var i=La();ne(i,21,()=>e.messages,re,(t,u,d)=>{var x=Ta(),y=H(x);O(y,()=>d===0||o(u).created_at-e.messages[d-1].created_at>r||new Date(o(u).created_at*1e3).getDay()!==new Date(e.messages[d-1].created_at*1e3).getDay(),v=>{var n=Sa(),s=I(n);M(()=>C(s,`- ${new Date(o(u).created_at*1e3).toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!1})??""} -`)),A(n),E(v,n)});var _=L(y,2);O(_,()=>o(u).sender_id==="system",v=>{Ma(v,{get message(){return o(u)}})},v=>{var n=Y(()=>e.messages[d-1]??void 0);ba(v,{get message(){return o(u)},get lastMessage(){return o(n)},get convertImageUrl(){return e.convertImageUrl},get convertVideoUrl(){return e.convertVideoUrl},get users(){return e.users}})}),E(t,x)}),A(i),E(a,i),se()}var Ua=b("<option> </option>"),Da=b('<span> </span> <div class="messages svelte-14pc9j"><!></div>',1),Na=b("<span>Loading...</span> <span>(this may take a while)</span>",1),Oa=b("<select><option>Select a chat</option><!></select> <!>",1),Ra=b("<p>Loading...</p>");function qa(a,e){te(e,!0);async function r(){const s=await(await fetch("/api/chats/")).json();return console.log(s),s}async function i(n){const l=await(await fetch("/api/chat/"+n)).json();return console.log(l),l}function t(n){return(s,l)=>{const h=new URL(l).pathname.substring(1).split("."),w=h[0],m=h[1],c=h[2];return"/data/"+n+"/gallery/"+s+"_"+w+"."+c+"."+m}}function u(n){return(s,l)=>{var c;const f=(c=l.split("/").pop())==null?void 0:c.split(".");if(!f)return"";const h=f[0],w=f[1],m=f[2];return"/data/"+n+"/gallery/"+s+"_"+h+"."+w+"."+m}}let d=r(),x=K(void 0),y=Y(()=>o(x)?i(o(x)):void 0);var _=B(),v=H(_);we(v,()=>d,n=>{var s=Ra();E(n,s)},(n,s)=>{var l=Oa(),f=H(l),h=I(f);h.value=(h.__value=void 0)==null?"":void 0;var w=L(h);ne(w,17,()=>Object.keys(o(s)),re,(c,g)=>{var p=Ua(),D={},k=I(p);A(p),M(()=>{var S,U;D!==(D=o(g))&&(p.value=(p.__value=o(g))==null?"":o(g)),C(k,(U=(S=o(s)[o(g)])==null?void 0:S.Metadata)==null?void 0:U.name)}),E(c,p)}),A(f);var m=L(f,2);O(m,()=>o(x),c=>{var g=B(),p=H(g);we(p,()=>o(y),D=>{var k=Na();L(H(k),2),E(D,k)},(D,k)=>{var S=Da(),U=H(S),N=I(U);A(U);var T=L(U,2),P=I(T),V=Y(()=>t(o(x))),F=Y(()=>u(o(x))),$=Y(()=>o(k).Metadata.members.reduce((X,Q)=>(X[Q.user_id]=Q,X),{}));Ca(P,{get messages(){return o(k).Messages},get convertImageUrl(){return o(V)},get convertVideoUrl(){return o(F)},get users(){return o($)}}),A(T),M(()=>C(N,`- ${o(k).Metadata.description??""}`)),E(D,S)}),E(c,g)}),va(f,()=>o(x),c=>z(x,c)),E(n,l)}),E(a,_),se()}export{qa as component};
